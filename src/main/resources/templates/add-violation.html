<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" 
    crossorigin="anonymous">
	<link href="https://use.fontawesome.com/releases/v5.0.4/css/all.css" rel="stylesheet">
    
    <link th:href="@{/css/image.css}" rel="stylesheet" />
    
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script type="text/javascript" th:src="@{/js/bootstrap-filestyle.min.js}" ></script>
	
	
	<title>Add Violation</title>
</head>
<body>
	
	<div class="container">

		<h3 th:if="${update}">Edit Violation</h3>
		<h3 th:unless="${update}">Add Violation</h3>
		<hr>
	
		<p class="h4 mb-4" th:if="${update}">Edit Violation</p>
		<p class="h4 mb-4" th:unless="${update}">Add Violation</p>
	
		<form action="#" th:action="@{/submit-violation}" th:object="${violation}"
			method="POST" enctype="multipart/form-data">
		
			<input type="hidden" name="violation_id" th:field="*{id}" /> 
			<input type="text" th:field="*{description}"
				class="form-control mb-4 col-4" placeholder="Description">
				
			<input type="date" th:field="*{dateOfViolation}"
				class="form-control mb-4 col-4" placeholder="Date of Violation"> 
				
			<style>
			  .ui-autocomplete-loading {
			    background: white url("images/ui-anim_basic_16x16.gif") right center no-repeat;
			  }
		  </style>
		  
			<script type="text/javascript">
				var listOfIds = [];
				var violatorId = '';
				$(function() {
					$("#violatorsAC").autocomplete({
						source: "/violatorsAutoComplete", 
						minLength: 1,
						select: function(event, ui) {
							this.value = ui.item.value;
							violatorId = ui.item.id;
							///alert(listOfIds);
							//alert(ui.item.id);
							//$("#Plant_ID").val(ui.item.value);
							return false;
						}
					});
		
				});
			</script>
			
			
			<div class="row mb-5">
				<div class="col-md-8">
					<input id="violatorsAC" type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" name="violatorsAC" 
					placeholder="Violators" value="">
				</div>
				<div class="col-md-4">
					<button type="button" class="btn btn-primary btn-add">Add</button>
				</div>	
			</div>
			
			<div class="col-md-12" style="margin-bottom: 2em;">
				<table width="50%">
		            <thead>
		                <tr>
		                    <th >Violator/s</th>
		                    <th></th>
		                </tr>
		            </thead>
		            <tbody class="violator-tbody-names">
		            	<tr th:each="violator: ${violation.violators}">
						    <td th:text="${violator.lastName + ', ' + violator.firstName}" />
						    <td><i class="fas fa-minus"></i></td>
						</tr>
		            </tbody>
	        	</table>
			</div>
			
			 <div class="col-md-8 mb-5">
				<!-- <input type="file" name="files" multiple >			 -->
				<input type="file" name="files" class="filestyle" data-classButton="btn btn-primary" data-input="false" data-classIcon="icon-plus" data-buttonText="Add File" multiple>
			</div> 
			
			<div th:if="${update}">
				<h5 >Images/Videos</h5>
				<hr>
			</div>
			<div class="row" >
				<!-- <img th:src="@{/uploads/apple.jfif}" alt="no image" class="img-fluid" /> -->
				<div class="column" >
					<div th:id="${'div_medium' + medium.id}" class="img-wrap" th:each="medium : ${media}" >
						<span class="close">&times;</span>
      					<img th:src="@{${'/uploads/' + medium.mediaFilePath}}" alt="" data-th-attr="data-id=${medium.id}" width="200" height="200">
      				</div>
    			</div>
			</div>

			<br>
			
			<div class="col-md-8 violator-inputs mb-2">
				<div th:each="violator: ${violation.violators}">
					<input type="hidden" class="form-control" name="violator_id[]" id="violator_id" th:value="${violator.id}">
				</div>
			</div>
			
			<div class="col-md-8 media-inputs mb-2">
			</div>
			
			<button type="submit" class="btn btn-info col-2" th:if="${update}">Save Changes</button>
			<button type="submit" class="btn btn-info col-2" th:unless="${update}">Submit</button>
	
		</form>
	
		<hr>
		
		<script>
			$( ".btn-add" ).click(function() {
				var violatorName = $("#violatorsAC").val();
				if(violatorName) {
					
					var name = '<tr><td>' + violatorName + '</td><td><i class="fas fa-minus"></i></td></tr>';
					$(".violator-tbody-names").append(name);
					$('.violator-inputs').append('<div><input type="hidden" class="form-control" name="violator_id[]" id="violator_id" value="' + violatorId +'"></div>');
					
					// cleanup
					$("#violatorsAC").val('');
					violatorId = '';
				}
				
			  	
			});

		</script>
		<script type="text/javascript" th:src="@{/js/image.js}" ></script>
	</div>

</body>
</html>